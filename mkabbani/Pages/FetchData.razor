@page "/fetchdata"

@using mkabbani.Data
<h1>Weather forecast</h1>

<p>This component demonstrates fetching data from a service.</p>
@if(customer!=null)
{
    <input type="text" bind="customer.Name" />
    <input type="text" bind="customer.Address.FullName" />
    <input type="text" bind="customer.Address.Email" />
    <input type="text" bind="customer.Address.Address" />
    <button type="button" @onclick="AddCustomer">Add</button>
    <br/>
}
@if (CustomerList == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <table class="table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in CustomerList)
            {
                <tr>
                    <td>@item.ID</td>
                    <td>@item.Name</td>
                </tr>
            }
        </tbody>
    </table>
}

@code {
    public List<Customers> CustomerList { get; set; }

    protected override async Task OnInitializedAsync()
    {
        customer = new Customers { Address = new Address()};
        CustomerList = new List<Customers>();
        var response = await new HttpClient().GetAsync("https://localhost:44373/api/customers");
        CustomerList = await response.Content.ReadAsAsync<List<Customers>>();
    }
    public Customers customer { get; set; }
    async void AddCustomer()
    {
        var response = await new HttpClient().PostAsJsonAsync("https://localhost:44373/api/customers", customer);
        if(response.StatusCode == System.Net.HttpStatusCode.Created)
        {
            //show sucss message
        }
        else
        {
            //shwo error message
        }
    }
}
